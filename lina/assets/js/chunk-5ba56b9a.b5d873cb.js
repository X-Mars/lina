(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ba56b9a"],{"2f29":function(e,t,s){"use strict";var a=s("8168"),i=s.n(a);i.a},"685f":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("GenericDetailPage",e._g(e._b({attrs:{object:e.ticket,"active-menu":e.config.activeMenu},on:{"update:object":function(t){e.ticket=t},"update:activeMenu":function(t){return e.$set(e.config,"activeMenu",t)},"update:active-menu":function(t){return e.$set(e.config,"activeMenu",t)}}},"GenericDetailPage",e.config,!1),e.$listeners),[s(e.config.activeMenu,{tag:"component",attrs:{object:e.ticket}})],1)},i=[],r=s("cd4a"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("GenericTicketDetail",{attrs:{object:e.object,"detail-card-items":e.detailCardItems,"special-card-items":e.specialCardItems,"assigned-card-items":e.assignedCardItems,approve:e.handleApprove,close:e.handleClose,reject:e.handleReject}},[e.hasActionPerm&&"closed"!==e.object.status?s("IBox",{staticClass:"box"},[s("div",{staticClass:"clearfix ibox-title",attrs:{slot:"header"},slot:"header"},[s("i",{staticClass:"fa fa-edit"}),e._v(" "+e._s(e.$t("common.Actions"))+"\n    ")]),e._v(" "),[s("el-form",{ref:"requestForm",staticClass:"assets",attrs:{model:e.requestForm,"label-width":"140px","label-position":"left"}},[s("el-form-item",{attrs:{label:e.$t("assets.Node")}},[s("Select2",e._b({staticStyle:{width:"50% !important"},model:{value:e.requestForm.nodes,callback:function(t){e.$set(e.requestForm,"nodes",t)},expression:"requestForm.nodes"}},"Select2",e.nodeSelect2,!1))],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("tickets.Asset")}},[s("Select2",e._b({staticStyle:{width:"50% !important"},model:{value:e.requestForm.assets,callback:function(t){e.$set(e.requestForm,"assets",t)},expression:"requestForm.assets"}},"Select2",e.assetSelect2,!1))],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("tickets.SystemUser"),rules:e.isRequired}},[s("Select2",e._b({staticStyle:{width:"50% !important"},model:{value:e.requestForm.systemusers,callback:function(t){e.$set(e.requestForm,"systemusers",t)},expression:"requestForm.systemusers"}},"Select2",e.systemuserSelect2,!1))],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("common.dateStart"),required:""}},[s("el-date-picker",{attrs:{type:"datetime"},model:{value:e.requestForm.apply_date_start,callback:function(t){e.$set(e.requestForm,"apply_date_start",t)},expression:"requestForm.apply_date_start"}})],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("common.dateExpired"),required:""}},[s("el-date-picker",{attrs:{type:"datetime"},model:{value:e.requestForm.apply_date_expired,callback:function(t){e.$set(e.requestForm,"apply_date_expired",t)},expression:"requestForm.apply_date_expired"}})],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("assets.Action"),required:""}},[s("PermissionFormActionField",{staticStyle:{width:"30% !important"},attrs:{value:e.requestForm.actions},model:{value:e.requestForm.actions,callback:function(t){e.$set(e.requestForm,"actions",t)},expression:"requestForm.actions"}})],1)],1)]],2):e._e()],1)},c=[],n=(s("57e7"),s("7f7f"),s("ed08")),l=s("cf45"),u=s("e67a"),p=s("56f5"),d=s("9cdc"),m=s("ce4b"),h=s("0218"),_={name:"",components:{GenericTicketDetail:d["a"],IBox:u["a"],Select2:p["a"],PermissionFormActionField:m["a"]},props:{object:{type:Object,default:function(){return{}}}},data:function(){return{statusMap:"open"===this.object.status?h["d"]["pending"]:h["d"][this.object.state],requestForm:{nodes:this.object.apply_nodes,assets:this.object.apply_assets,systemusers:this.object.apply_system_users,actions:this.object.apply_actions,apply_date_expired:this.object.apply_date_expired,apply_date_start:this.object.apply_date_start},nodeSelect2:{multiple:!0,value:this.object.apply_nodes,ajax:{url:function(e){var t=e.org_id;return"/api/v1/assets/nodes/?oid=".concat(t,"&protocol__in=rdp,vnc,ssh,telnet")}(this.object),transformOption:function(e){return{label:"".concat(e.full_value),value:e.id}}}},assetSelect2:{multiple:!0,value:this.object.apply_assets,ajax:{url:function(e){var t=e.org_id;return"/api/v1/assets/assets/?oid=".concat(t,"&protocol__in=rdp,vnc,ssh,telnet")}(this.object),transformOption:function(e){return{label:e.hostname,value:e.id}}}},systemuserSelect2:{multiple:!0,value:this.object.apply_system_users,ajax:{url:function(e){var t=e.org_id;return"/api/v1/assets/system-users/?oid=".concat(t,"&protocol__in=rdp,vnc,ssh,telnet")}(this.object),transformOption:function(e){var t=e.username||"*";return{label:e.name+"("+t+")",value:e.id}}}}}},computed:{isRequired:function(){return this.object.approval_step===this.object.process_map.length?[{required:!0}]:[{required:!1}]},detailCardItems:function(){var e=this,t=this.$createElement,s=this.object;return[{key:this.$t("common.Number"),value:s.serial_num},{key:this.$t("tickets.status"),value:s.state,formatter:function(s,a){return t("el-tag",{attrs:{type:e.statusMap.type,size:"mini"}},[" ",e.statusMap.title])}},{key:this.$t("tickets.type"),value:s.type_display},{key:this.$t("tickets.user"),value:s.rel_snapshot.applicant},{key:this.$t("tickets.OrgName"),value:s.org_name},{key:this.$t("common.dateCreated"),value:Object(l["q"])(s.date_created)},{key:this.$t("common.Comment"),value:s.comment}]},specialCardItems:function(){var e=this.object,t=e.rel_snapshot;return[{key:this.$t("perms.Node"),value:t.apply_nodes.join(", ")},{key:this.$t("tickets.Asset"),value:t.apply_assets.join(", ")},{key:this.$t("tickets.SystemUser"),value:t.apply_system_users.join(", ")},{key:this.$t("assets.Action"),value:Object(l["c"])(this,e.apply_actions_display)},{key:this.$t("common.dateStart"),value:Object(l["q"])(e.apply_date_start)},{key:this.$t("common.dateExpired"),value:Object(l["q"])(e.apply_date_expired)}]},assignedCardItems:function(){var e=this.$createElement,t=this,s=this.object,a=s.rel_snapshot;return[{key:this.$t("tickets.PermissionName"),value:s.apply_permission_name,formatter:function(a,i){var r={name:"AssetPermissionDetail",params:{id:s.id},query:{oid:s.org_id}};return t.$hasPerm("perms.view_assetpermission")&&"closed"===s.status&&"approved"===s.state?e("router-link",{attrs:{to:r}},[i]):e("span",[i])}},{key:this.$t("perms.Node"),value:a.apply_nodes.join(", ")},{key:this.$t("assets.Asset"),value:a.apply_assets.join(", ")},{key:this.$t("tickets.SystemUser"),value:a.apply_system_users.join(", ")},{key:this.$t("assets.Action"),value:Object(l["c"])(this,s.apply_actions_display)},{key:this.$t("common.dateStart"),value:Object(l["q"])(s.apply_date_start)},{key:this.$t("common.dateExpired"),value:Object(l["q"])(s.apply_date_expired)}]},hasActionPerm:function(){var e=this.object.approval_step,t=this.$store.state.users.profile.id;return-1!==this.object.process_map[e-1].assignees.indexOf(t)}},methods:{formatTime:function(e){return Object(n["a"])(Object(n["b"])(e))},toSafeLocalDateStr:function(e){return Object(l["q"])(e)},reloadPage:function(){window.location.reload()},handleApprove:function(){var e=this;if(this.object.approval_step===this.object.process_map.length){var t=this.requestForm.assets.length,s=this.requestForm.nodes.length;if(0===t&&0===s)return this.$message.error(this.$tc("common.SelectAtLeastOneAssetOrNodeErrMsg"));if(0===this.requestForm.systemusers.length)return this.$message.error(this.$tc("common.RequiredSystemUserErrMsg"))}this.$axios.patch("/api/v1/tickets/apply-asset-tickets/".concat(this.object.id,"/approve/"),{apply_system_users:this.requestForm.systemusers?this.requestForm.systemusers:[],apply_nodes:this.requestForm.nodes?this.requestForm.nodes:[],apply_assets:this.requestForm.assets?this.requestForm.assets:[],apply_actions:this.requestForm.actions,apply_date_start:this.requestForm.apply_date_start,apply_date_expired:this.requestForm.apply_date_expired,org_id:this.object.org_id}).then((function(){e.$message.success(e.$tc("common.updateSuccessMsg")),e.reloadPage()})).catch((function(){e.$message.success(e.$tc("common.updateErrorMsg"))}))},handleClose:function(){var e=this,t="/api/v1/tickets/apply-asset-tickets/".concat(this.object.id,"/close/");this.$axios.put(t).then((function(t){return e.reloadPage()})).catch((function(t){return e.$message.error(t)}))},handleReject:function(){var e=this,t="/api/v1/tickets/apply-asset-tickets/".concat(this.object.id,"/reject/");this.$axios.put(t).then((function(t){return e.reloadPage()})).catch((function(t){return e.$message.error(t)}))}}},y=_,f=(s("2f29"),s("2877")),b=Object(f["a"])(y,o,c,!1,null,"48e7886c",null),v=b.exports,$={components:{GenericDetailPage:r["e"],TicketDetail:v,TabPage:r["m"]},data:function(){return{ticket:{title:"",user_display:"",type_display:"",status:"",processor:"",date_created:""},config:{activeMenu:"TicketDetail",url:"",submenu:[{title:this.$t("route.TicketDetail"),name:"TicketDetail"}],actions:{detailApiUrl:"/api/v1/tickets/apply-asset-tickets/".concat(this.$route.params.id,"/")},getObjectName:this.getObjectName,hasRightSide:!1}}},methods:{getObjectName:function(){return this.ticket.title}}},k=$,j=Object(f["a"])(k,a,i,!1,null,"71f3b35a",null);t["default"]=j.exports},8168:function(e,t,s){},ce4b:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-tree",e._b({attrs:{data:e.iData,"show-checkbox":"","node-key":"id","default-expand-all":!0,"default-checked-keys":e.value,props:e.defaultProps},on:{check:e.handleCheckChange}},"el-tree",e.$attrs,!1))},i=[],r=(s("6762"),s("2fdb"),s("ac4d"),s("8a81"),s("ac6a"),s("6d67"),{name:"PermissionFormActionField",props:{value:{type:Array,default:function(){return[]}},choices:{type:Array,default:function(){return[]}},actions:{type:Array,default:function(){return[]}}},data:function(){return{defaultProps:{children:"children",label:"label"},fullChoicesTreeNodes:[{id:"all",label:this.$t("perms.all"),children:[{id:"connect",label:this.$t("perms.connect")},{id:"updownload",label:this.$t("perms.upDownload"),children:[{id:"upload_file",label:this.$t("perms.uploadFile")},{id:"download_file",label:this.$t("perms.downloadFile")}]},{id:"clipboard_copy_paste",label:this.$t("perms.clipboardCopyPaste"),children:[{id:"clipboard_copy",label:this.$t("perms.clipboardCopy")},{id:"clipboard_paste",label:this.$t("perms.clipboardPaste")}]}]}]}},computed:{choicesIDs:function(){return 0!==this.actions.length?this.actions:0===this.choices.length?["all","connect","upload_file","download_file","updownload","clipboard_copy_paste","clipboard_copy","clipboard_paste"]:this.choices.map((function(e){return e.value}))},iData:function(){this.$log.debug("choices: ",this.choicesIDs);var e=_.cloneDeep(this.fullChoicesTreeNodes),t=this.trimChoicesTreeNodes(e);return this.$log.debug("choicesTreeNodes: ",t),t}},methods:{trimChoicesTreeNodes:function(e){var t=[],s=!0,a=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(s=(r=o.next()).done);s=!0){var c=r.value;if(this.choicesIDs.includes(c.id)){var n=c.children||[];0!==n.length&&(n=this.trimChoicesTreeNodes(n),c.children=n),t.push(c)}}}catch(l){a=!0,i=l}finally{try{s||null==o.return||o.return()}finally{if(a)throw i}}return t},handleCheckChange:function(e,t){var s=t.checkedKeys;0!==s.length&&s.push("connect"),this.$emit("input",s)}}}),o=r,c=s("2877"),n=Object(c["a"])(o,a,i,!1,null,"2d0b5919",null);t["a"]=n.exports}}]);