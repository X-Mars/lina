(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2174e3ca"],{"2ad7":function(e,t,a){},"33f7":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("GenericDetailPage",e._g(e._b({attrs:{object:e.ticket,"active-menu":e.config.activeMenu},on:{"update:object":function(t){e.ticket=t},"update:activeMenu":function(t){return e.$set(e.config,"activeMenu",t)},"update:active-menu":function(t){return e.$set(e.config,"activeMenu",t)}}},"GenericDetailPage",e.config,!1),e.$listeners),[a(e.config.activeMenu,{tag:"component",attrs:{object:e.ticket}})],1)},i=[],r=a("cd4a"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("GenericTicketDetail",{attrs:{object:e.object,"detail-card-items":e.detailCardItems,"special-card-items":e.specialCardItems,"assigned-card-items":e.assignedCardItems,approve:e.handleApprove,close:e.handleClose,reject:e.handleReject}},[e.hasActionPerm&&"closed"!==e.object.status?a("IBox",{staticClass:"box"},[a("div",{staticClass:"clearfix ibox-title",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"fa fa-edit"}),e._v(" "+e._s(e.$t("common.Actions"))+"\n    ")]),e._v(" "),[a("el-form",{ref:"requestForm",staticClass:"assets",attrs:{model:e.requestForm,"label-width":"140px","label-position":"left"}},[a("el-form-item",{attrs:{label:e.$t("assets.Applications"),rules:e.isRequired}},[a("Select2",e._b({staticStyle:{width:"50% !important"},model:{value:e.requestForm.applications,callback:function(t){e.$set(e.requestForm,"applications",t)},expression:"requestForm.applications"}},"Select2",e.appsSelect2,!1))],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("tickets.SystemUser"),rules:e.isRequired}},[a("Select2",e._b({staticStyle:{width:"50% !important"},model:{value:e.requestForm.systemusers,callback:function(t){e.$set(e.requestForm,"systemusers",t)},expression:"requestForm.systemusers"}},"Select2",e.systemuserSelect2,!1))],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("common.dateStart"),required:""}},[a("el-date-picker",{attrs:{type:"datetime"},model:{value:e.requestForm.apply_date_start,callback:function(t){e.$set(e.requestForm,"apply_date_start",t)},expression:"requestForm.apply_date_start"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("common.dateExpired"),required:""}},[a("el-date-picker",{attrs:{type:"datetime"},model:{value:e.requestForm.apply_date_expired,callback:function(t){e.$set(e.requestForm,"apply_date_expired",t)},expression:"requestForm.apply_date_expired"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("assets.Action"),required:""}},[a("PermissionFormActionField",{staticStyle:{width:"30% !important"},attrs:{value:e.requestForm.actions,actions:e.actions},model:{value:e.requestForm.actions,callback:function(t){e.$set(e.requestForm,"actions",t)},expression:"requestForm.actions"}})],1)],1)]],2):e._e()],1)},c=[],n=a("75fc"),l=(a("57e7"),a("7f7f"),a("d92a"),a("e67a")),p=a("cf45"),u=a("56f5"),d=a("ed08"),m=a("9cdc"),h=a("ce4b"),y=a("0218"),_={name:"",components:{GenericTicketDetail:m["a"],IBox:l["a"],Select2:u["a"],PermissionFormActionField:h["a"]},props:{object:{type:Object,default:function(){return{}}}},data:function(){return{statusMap:"open"===this.object.status?y["d"]["pending"]:y["d"][this.object.state],actions:this.dynamicActions(),requestForm:{applications:this.object.apply_applications,systemusers:this.object.apply_system_users,actions:this.object.apply_actions,apply_date_expired:this.object.apply_date_expired,apply_date_start:this.object.apply_date_start},appsSelect2:{multiple:!0,value:this.object.apply_applications,ajax:{url:function(){var e=this.object.org_id;return"/api/v1/applications/applications/?oid=".concat(e,"&type=").concat(this.object.apply_type)}.bind(this)(),transformOption:function(e){return{label:e.name,value:e.id}}}},systemuserSelect2:{multiple:!0,value:this.object.apply_system_users,ajax:{url:function(){var e=this.object.org_id,t="remote_app"===this.object.apply_category?"rdp":this.object.apply_type;return"/api/v1/assets/system-users/?oid=".concat(e,"&protocol=").concat(t)}.bind(this)(),transformOption:function(e){var t=e.username||"*";return{label:e.name+"("+t+")",value:e.id}}}}}},computed:{isRequired:function(){return this.object.approval_step===this.object.process_map.length?[{required:!0}]:[{required:!1}]},detailCardItems:function(){var e=this,t=this.$createElement,a=this.object;return[{key:this.$t("common.Number"),value:a.serial_num},{key:this.$t("tickets.status"),value:a.status,formatter:function(a,s){return t("el-tag",{attrs:{type:e.statusMap.type,size:"mini"}},[" ",e.statusMap.title])}},{key:this.$t("tickets.type"),value:a.type_display},{key:this.$t("tickets.user"),value:a.rel_snapshot.applicant},{key:this.$t("tickets.OrgName"),value:a.org_name},{key:this.$t("common.dateCreated"),value:Object(p["q"])(a.date_created)},{key:this.$t("common.Comment"),value:a.comment}]},specialCardItems:function(){var e=this.object,t=e.rel_snapshot;return[{key:this.$t("applications.appType"),value:"".concat(e.apply_category," / ").concat(e.apply_type," ")},{key:this.$t("applications.appName"),value:t.apply_applications.join(", ")},{key:this.$t("tickets.SystemUser"),value:t.apply_system_users.join(", ")},{key:this.$t("assets.Action"),value:Object(p["c"])(this,e.apply_actions_display)},{key:this.$t("common.dateStart"),value:Object(p["q"])(e.apply_date_start)},{key:this.$t("common.dateExpired"),value:Object(p["q"])(e.apply_date_expired)}]},assignedCardItems:function(){var e=this.$createElement,t=this,a=this.object,s=a.rel_snapshot;return[{key:this.$t("tickets.PermissionName"),value:t.object.apply_permission_name,formatter:function(s,i){var r={name:"ApplicationPermissionDetail",params:{id:a.id},query:{oid:a.org_id}};return t.$hasPerm("perms.view_applicationpermission")&&"closed"===a.status&&"approved"===a.state?e("router-link",{attrs:{to:r}},[i]):e("span",[i])}},{key:this.$t("applications.appName"),value:s.apply_applications.join(", ")},{key:this.$t("tickets.SystemUser"),value:s.apply_system_users.join(", ")},{key:this.$t("common.dateStart"),value:Object(p["q"])(a.apply_date_start)},{key:this.$t("common.dateExpired"),value:Object(p["q"])(a.apply_date_expired)}]},hasActionPerm:function(){var e=this.object.approval_step,t=this.$store.state.users.profile.id;return-1!==this.object.process_map[e-1].assignees.indexOf(t)}},methods:{dynamicActions:function(){var e=this.object.apply_category,t=[];return this.$axios.get("/api/v1/perms/application-permissions/applications/actions/?category=".concat(e)).then((function(e){t.push.apply(t,Object(n["a"])(e))})),t},formatTime:function(e){return Object(d["a"])(Object(d["b"])(e))},toSafeLocalDateStr:function(e){return Object(p["q"])(e)},reloadPage:function(){window.location.reload()},handleApprove:function(){var e=this;if(this.object.approval_step===this.object.process_map.length&&(0===this.requestForm.applications.length||0===this.requestForm.systemusers.length))return this.$message.error(this.$tc("common.NeedAddAppsOrSystemUserErrMsg"));this.$axios.patch("/api/v1/tickets/apply-app-tickets/".concat(this.object.id,"/approve/"),{apply_category:this.object.apply_category,apply_type:this.object.apply_type,apply_system_users:this.requestForm.systemusers?this.requestForm.systemusers:[],apply_applications:this.requestForm.applications?this.requestForm.applications:[],apply_actions:this.requestForm.actions,apply_date_start:this.requestForm.apply_date_start,apply_date_expired:this.requestForm.apply_date_expired,org_id:this.object.org_id}).then((function(){e.$message.success(e.$tc("common.updateSuccessMsg")),e.reloadPage()})).catch((function(){return e.$message.success(e.$tc("common.updateErrorMsg"))}))},handleClose:function(){var e=this,t="/api/v1/tickets/apply-app-tickets/".concat(this.object.id,"/close/");this.$axios.put(t).then((function(t){return e.reloadPage()})).catch((function(t){return e.$message.error(t)}))},handleReject:function(){var e=this,t="/api/v1/tickets/apply-app-tickets/".concat(this.object.id,"/reject/");this.$axios.put(t).then((function(t){return e.reloadPage()})).catch((function(t){return e.$message.error(t)}))}}},b=_,f=(a("3a87"),a("2877")),v=Object(f["a"])(b,o,c,!1,null,"382ebb1e",null),j=v.exports,$={components:{GenericDetailPage:r["e"],TicketDetail:j,TabPage:r["m"]},data:function(){return{ticket:{title:"",user_display:"",type_display:"",status:"",assignees_display:"",date_created:""},config:{activeMenu:"TicketDetail",url:"",submenu:[{title:this.$t("route.TicketDetail"),name:"TicketDetail"}],actions:{detailApiUrl:"/api/v1/tickets/apply-app-tickets/".concat(this.$route.params.id,"/")},getObjectName:this.getObjectName,hasRightSide:!1}}},mounted:function(){},methods:{getObjectName:function(){return this.ticket.title}}},k=$,g=Object(f["a"])(k,s,i,!1,null,"269bdc1e",null);t["default"]=g.exports},"3a87":function(e,t,a){"use strict";var s=a("2ad7"),i=a.n(s);i.a},ce4b:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tree",e._b({attrs:{data:e.iData,"show-checkbox":"","node-key":"id","default-expand-all":!0,"default-checked-keys":e.value,props:e.defaultProps},on:{check:e.handleCheckChange}},"el-tree",e.$attrs,!1))},i=[],r=(a("6762"),a("2fdb"),a("ac4d"),a("8a81"),a("ac6a"),a("6d67"),{name:"PermissionFormActionField",props:{value:{type:Array,default:function(){return[]}},choices:{type:Array,default:function(){return[]}},actions:{type:Array,default:function(){return[]}}},data:function(){return{defaultProps:{children:"children",label:"label"},fullChoicesTreeNodes:[{id:"all",label:this.$t("perms.all"),children:[{id:"connect",label:this.$t("perms.connect")},{id:"updownload",label:this.$t("perms.upDownload"),children:[{id:"upload_file",label:this.$t("perms.uploadFile")},{id:"download_file",label:this.$t("perms.downloadFile")}]},{id:"clipboard_copy_paste",label:this.$t("perms.clipboardCopyPaste"),children:[{id:"clipboard_copy",label:this.$t("perms.clipboardCopy")},{id:"clipboard_paste",label:this.$t("perms.clipboardPaste")}]}]}]}},computed:{choicesIDs:function(){return 0!==this.actions.length?this.actions:0===this.choices.length?["all","connect","upload_file","download_file","updownload","clipboard_copy_paste","clipboard_copy","clipboard_paste"]:this.choices.map((function(e){return e.value}))},iData:function(){this.$log.debug("choices: ",this.choicesIDs);var e=_.cloneDeep(this.fullChoicesTreeNodes),t=this.trimChoicesTreeNodes(e);return this.$log.debug("choicesTreeNodes: ",t),t}},methods:{trimChoicesTreeNodes:function(e){var t=[],a=!0,s=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var c=r.value;if(this.choicesIDs.includes(c.id)){var n=c.children||[];0!==n.length&&(n=this.trimChoicesTreeNodes(n),c.children=n),t.push(c)}}}catch(l){s=!0,i=l}finally{try{a||null==o.return||o.return()}finally{if(s)throw i}}return t},handleCheckChange:function(e,t){var a=t.checkedKeys;0!==a.length&&a.push("connect"),this.$emit("input",a)}}}),o=r,c=a("2877"),n=Object(c["a"])(o,s,i,!1,null,"2d0b5919",null);t["a"]=n.exports}}]);