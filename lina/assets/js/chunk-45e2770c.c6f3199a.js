(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-45e2770c"],{"33d0":function(e,t,n){},"352c":function(e,t,n){"use strict";var r=n("9778"),a=n.n(r);a.a},"53af":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Page",e._b({},"Page",e.$attrs,!1),[n("div",[n("el-table",{attrs:{data:e.tableData,"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"},"span-method":e.spanMethod,stripe:!0}},[n("el-table-column",{attrs:{label:e.$t("notifications.MessageType"),width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.value))])]}}])}),e._v(" "),e._l(e.receiveBackends,(function(t){return n("el-table-column",{key:t.id,attrs:{label:e.getNameDisplay(t),width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[r.row.children?e._e():n("span",["site_msg"!==t.name?n("el-checkbox",{on:{change:function(t){return e.onCheckReceiveBackend(r.row)}},model:{value:r.row.receiveBackends[t.name],callback:function(n){e.$set(r.row.receiveBackends,t.name,n)},expression:"scope.row.receiveBackends[header.name]"}}):n("el-checkbox",{attrs:{value:!0,disabled:!0}})],1)]}}],null,!0)})})),e._v(" "),n("el-table-column",{attrs:{label:e.$t("notifications.Receivers"),"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children?e._e():n("span",[e._v("\n            "+e._s(t.row.receivers.map((function(e){return e.name})).join(", "))+"\n          ")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("common.Actions"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children?e._e():n("el-button",{attrs:{type:"small"},on:{click:function(n){return e.onOpenDialog(t.row)}}},[e._v("\n            "+e._s(e.$t("notifications.ChangeReceiver"))+"\n          ")])]}}])})],2),e._v(" "),e.dialogVisible?n("SelectDialog",{attrs:{visible:e.dialogVisible,title:e.$t("notifications.ChangeReceiver"),"selected-users":e.dialogSelectedUsers},on:{"update:visible":function(t){e.dialogVisible=t},submit:e.onDialogSelectSubmit,cancel:function(t){e.dialogVisible=!1}}}):e._e()],1)])},a=[],i=(n("57e7"),n("7f7f"),n("d25f"),n("ac4d"),n("8a81"),n("f3e2"),n("768b")),s=(n("ac6a"),n("ffc1"),n("96cf"),n("3b8d")),c=n("83b2"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dialog",e._g(e._b({ref:"myDialog",attrs:{"destroy-on-close":!0,width:"790px",height:"720px"},on:{confirm:e.submit}},"Dialog",e.$attrs,!1),e.$listeners),[n("krryPaging",e._b({ref:"pageTransfer",staticClass:"transfer"},"krryPaging",e.pagingTransfer,!1))],1)},u=[],l=(n("6d67"),n("9039")),d=n("c04f"),f=n("2612"),p={name:"ListSelect",components:{Dialog:l["a"],krryPaging:d["krryPaging"]},inheritAttrs:!1,props:{selectedUsers:{type:Array,default:function(){return[]}}},data:function(){return{pagingTransfer:{pageSize:10,filterable:!0,async:!0,dataList:[],getPageData:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=n,a=(t-1)*n,i={limit:r,offset:a,oid:"ROOT"},e.next=5,Object(f["b"])(i);case 5:return s=e.sent,c=s["results"].map((function(e){return{id:e.id,label:"".concat(e.name,"(").concat(e.username,")")}})),e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}(),getSearchData:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,i,s,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=r,i=(n-1)*r,s={limit:a,offset:i,oid:"ROOT",search:t},e.next=5,Object(f["b"])(s);case 5:return c=e.sent,o=c["results"].map((function(e){return{id:e.id,label:"".concat(e.name,"(").concat(e.username,")")}})),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));function t(t,n,r){return e.apply(this,arguments)}return t}(),selectedData:[],showClearBtn:!0}}},mounted:function(){var e=this,t=this.selectedUsers.map((function(e){return{id:e.id,label:e.name}}));setTimeout((function(){e.pagingTransfer.selectedData=t}),500)},methods:{submit:function(){var e=this.$refs.pageTransfer.getSelectedData();this.$emit("submit",e)}}},h=p,v=(n("352c"),n("2877")),b=Object(v["a"])(h,o,u,!1,null,"2af56eca",null),m=b.exports,g={components:{Page:c["a"],SelectDialog:m},data:function(){return{currentEditSub:{},dialogVisible:!1,dialogSelectedUsers:[],receiveBackends:[],tableData:[],idMessageTypeMapper:{},idBackendMapper:{}}},mounted:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initBackends();case 2:return e.next=4,this.initSubscriptions();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{onCheckReceiveBackend:function(e){for(var t=this,n=[],r=0,a=Object.entries(e.receiveBackends);r<a.length;r++){var s=Object(i["a"])(a[r],2),c=s[0],o=s[1];o&&n.push(c)}this.$axios.patch("/api/v1/notifications/system-msg-subscription/".concat(e.id,"/"),{receive_backends:n}).catch((function(e){t.$log.error(e)}))},spanMethod:function(e){e.row,e.column,e.rowIndex,e.columnIndex},onDialogSelectSubmit:function(e){var t=this;this.dialogVisible=!1,this.$axios.patch("/api/v1/notifications/system-msg-subscription/".concat(this.currentEditSub.id,"/"),{users:e}).then((function(e){var n=t.idMessageTypeMapper[e.message_type];n.receivers=e.receivers,t.tableData.forEach((function(t){var n=!0,r=!1,a=void 0;try{for(var i,s=t.children[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.id===e.message_type){c.receivers=e.receivers;break}}}catch(o){r=!0,a=o}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}}))})).catch((function(){}))},getNameDisplay:function(e){var t=e["name_display"];return"Site message"===t?"Inbox":t},onOpenDialog:function(e){this.currentEditSub=e,this.dialogSelectedUsers=e.receivers,this.dialogVisible=!0},initBackends:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.$axios.get("/api/v1/notifications/backends/");case 3:t=e.sent,this.receiveBackends=t.filter((function(e){return e.name}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),initSubscriptions:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,c,o,u,l,d,f,p,h,v,b,m=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.get("/api/v1/notifications/system-msg-subscription/");case 2:t=e.sent,n=[],r=!0,a=!1,i=void 0,e.prev=7,s=t[Symbol.iterator]();case 9:if(r=(c=s.next()).done){e.next=37;break}for(o=c.value,u=[],l={id:o["category"],value:o["category_label"],children:u},d=!0,f=!1,p=void 0,e.prev=16,h=function(){var e=b.value,t={};m.receiveBackends.forEach((function(n){t[n.name]=e["receive_backends"].indexOf(n.name)>-1}));var n={id:e["message_type"],value:e["message_type_label"],receivers:e.receivers,receiveBackends:t};u.push(n),m.idMessageTypeMapper[n.id]=u},v=o["children"][Symbol.iterator]();!(d=(b=v.next()).done);d=!0)h();e.next=25;break;case 21:e.prev=21,e.t0=e["catch"](16),f=!0,p=e.t0;case 25:e.prev=25,e.prev=26,d||null==v.return||v.return();case 28:if(e.prev=28,!f){e.next=31;break}throw p;case 31:return e.finish(28);case 32:return e.finish(25);case 33:n.push(l);case 34:r=!0,e.next=9;break;case 37:e.next=43;break;case 39:e.prev=39,e.t1=e["catch"](7),a=!0,i=e.t1;case 43:e.prev=43,e.prev=44,r||null==s.return||s.return();case 46:if(e.prev=46,!a){e.next=49;break}throw i;case 49:return e.finish(46);case 50:return e.finish(43);case 51:this.tableData=n;case 52:case"end":return e.stop()}}),e,this,[[7,39,43,51],[16,21,25,33],[26,,28,32],[44,,46,50]])})));function t(){return e.apply(this,arguments)}return t}()}},k=g,w=(n("90fb"),Object(v["a"])(k,r,a,!1,null,"42838198",null));t["default"]=w.exports},"90fb":function(e,t,n){"use strict";var r=n("33d0"),a=n.n(r);a.a},9778:function(e,t,n){}}]);